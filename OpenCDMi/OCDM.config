set(autostart ${PLUGIN_OPENCDMI_AUTOSTART})
set(preconditions Provisioning)

if(PLUGIN_OPENCDMI_PLAYREADY_NEXUS OR PLUGIN_OPENCDMI_PLAYREADY_NEXUS_SVP OR PLUGIN_OPENCDMI_NAGRA)
    set(preconditions ${preconditions} Platform)
endif()

if(PLUGIN_OCDM_STARTUPORDER)
set (startuporder ${PLUGIN_OCDM_STARTUPORDER})
endif()

map()
    kv(locator lib${PLUGIN_OCDM_IMPLEMENTATION}.so)
    if(PLUGIN_OPENCDMI_MODE)
        kv(mode ${PLUGIN_OPENCDMI_MODE})
    else()
        if (PLUGIN_OPENCDMI_OOP)
            kv(mode "Local")
        else()
            kv(mode "Off")
        endif()
    endif()
    if(PLUGIN_OPENCDMI_USER)
        kv(user ${PLUGIN_OPENCDMI_USER})
    endif()
    if(PLUGIN_OPENCDMI_GROUP)
        kv(group ${PLUGIN_OPENCDMI_GROUP})
    endif()
end()
ans(rootobject)

map()
    kv(sharepath "/tmp/OCDM")
    kv(systems ___array___)
    if (NOT PLUGIN_OPENCDMI_MODE)
       kv(outofprocess ${PLUGIN_OPENCDMI_OOP})
    endif()
end()
ans(configuration)


if(PLUGIN_OPENCDMI_CLEARKEY)
map()
    kv(name "ClearKey")
    kv(designators "___array___;org.chromium.externalclearkey;org.w3.clearkey")
end()
ans(keysystem)
map_append(${configuration} systems ___array___ ${keysystem})
endif()

if(PLUGIN_OPENCDMI_PLAYREADY OR PLUGIN_OPENCDMI_PLAYREADY_NEXUS OR PLUGIN_OPENCDMI_PLAYREADY_NEXUS_SVP OR PLUGIN_OPENCDMI_PLAYREADY_VGDRM)
map()
    kv(name "PlayReady")
    kv(designators "com.youtube.playready;com.microsoft.playready;com.netflix.playready")
    key(configuration)
    map()
        if(PLUGIN_OPENCDMI_PLAYREADY_METERING_CERTIFICATE)
            kv(metering ${PLUGIN_OPENCDMI_PLAYREADY_METERING_CERTIFICATE})
        endif()
        if(PLUGIN_OCDM_PLAYREADY_READ_DIR)
            kv(read-dir "${PLUGIN_OCDM_PLAYREADY_READ_DIR}")
        endif()
        if(PLUGIN_OCDM_PLAYREADY_STORE_LOCATION)
            kv(store-location "${PLUGIN_OCDM_PLAYREADY_STORE_LOCATION}")
        endif()
        if(PLUGIN_OPENCDMI_PLAYREADY_CERTIFICATE_LABEL)
            kv(certificatelabel "${PLUGIN_OPENCDMI_PLAYREADY_CERTIFICATE_LABEL}")
        endif()
    end()
end()
ans(keysystem)
map_append(${configuration} systems ___array___ ${keysystem})
endif()

if(PLUGIN_OPENCDMI_WIDEVINE OR OPENCDMI_WIDEVINE_NEXUS_SVP)
map()
    kv(name "WideVine")
    kv(designators "___array___;com.widevine.alpha")

    key(configuration)
    map()
        kv(certificate ${PLUGIN_OPENCDMI_WIDEVINE_DEVICE_CERTIFICATE})
        if(PLUGIN_OPENCDMI_WIDEVINE_KEYBOX)
            kv(keybox ${PLUGIN_OPENCDMI_WIDEVINE_KEYBOX})
        endif()
        if(PLUGIN_OPENCDMI_WIDEVINE_STORAGE_LOCATION)
            kv(storagelocation ${PLUGIN_OPENCDMI_WIDEVINE_STORAGE_LOCATION})
        endif()
    end()
end()
ans(keysystem)
map_append(${configuration} systems ___array___ ${keysystem})
endif()

if(PLUGIN_OPENCDMI_NAGRA)
map()
    kv(name "NagraSystem")
    kv(designators "___array___;com.nagra.system")
    key(configuration)
    map()
        kv(operatorvault "/tmp/ov.json")
        kv(licensepath "/tmp/licenses")
    end()
end()
ans(keysystem)
map_append(${configuration} systems ___array___ ${keysystem})
map()
    kv(name "NagraConnect")
    kv(designators "___array___;com.nagra.connect")
end()
ans(keysystem)
map_append(${configuration} systems ___array___ ${keysystem})
endif()


if(PLUGIN_OPENCDMI_NCAS)
map()
    kv(name "Ncas")
    kv(designators "___array___;com.ncas.alpha")
end()
ans(keysystem)
map_append(${configuration} systems ___array___ ${keysystem})
endif()

map_append(${configuration} root ${rootobject})
